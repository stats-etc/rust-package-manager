# Makefile –¥–ª—è Rust Package Manager

.PHONY: build run test clean demo help install release

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
CARGO = cargo
TARGET_DIR = target
BINARY_NAME = rust-package-manager

# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
all: build

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
build:
	@echo "üî® –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
	$(CARGO) build

# –°–±–æ—Ä–∫–∞ –≤ release —Ä–µ–∂–∏–º–µ
release:
	@echo "üöÄ –°–±–æ—Ä–∫–∞ release –≤–µ—Ä—Å–∏–∏..."
	$(CARGO) build --release

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
run:
	@echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã..."
	$(CARGO) run

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
test:
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
	$(CARGO) test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
test-verbose:
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (–ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥)..."
	$(CARGO) test -- --nocapture

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
check:
	@echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞..."
	$(CARGO) check

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
fmt:
	@echo "‚ú® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞..."
	$(CARGO) fmt

# –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞
lint:
	@echo "üìã –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞..."
	$(CARGO) clippy -- -D warnings

# –û—á–∏—Å—Ç–∫–∞ —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
	$(CARGO) clean
	rm -f packages.json

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è packages.json)
clean-all: clean
	@echo "üóëÔ∏è  –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞..."
	rm -f packages.json demo_commands.txt

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π
demo:
	@echo "üé¨ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π..."
	@./demo.sh

# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
quick-demo:
	@echo "‚ö° –ë—ã—Å—Ç—Ä–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è..."
	@printf "available\ninstall firefox\ninstall python 3.12.0\nlist\nsearch browser\nremove firefox\nlist\nexit\n" | $(CARGO) run

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
deps:
	@echo "üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	$(CARGO) update

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
doc:
	@echo "üìö –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
	$(CARGO) doc --open

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
check-fmt:
	@echo "üîé –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
	$(CARGO) fmt -- --check

# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
pre-commit: check-fmt lint test
	@echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ —Å–∏—Å—Ç–µ–º—É
install-system: release
	@echo "üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Å–∏—Å—Ç–µ–º—É..."
	cp $(TARGET_DIR)/release/$(BINARY_NAME) /usr/local/bin/rpm-rust || \
	cp $(TARGET_DIR)/release/$(BINARY_NAME) ~/.local/bin/rpm-rust || \
	echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ $(TARGET_DIR)/release/$(BINARY_NAME) –≤—Ä—É—á–Ω—É—é"

# –ë–µ–Ω—á–º–∞—Ä–∫–∏ (–µ—Å–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã)
bench:
	@echo "üìä –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤..."
	$(CARGO) bench

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ
info:
	@echo "‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ:"
	@echo "  –ù–∞–∑–≤–∞–Ω–∏–µ: Rust Package Manager"
	@echo "  –í–µ—Ä—Å–∏—è: $(shell grep version Cargo.toml | head -n1 | cut -d'"' -f2)"
	@echo "  –Ø–∑—ã–∫: Rust $(shell rustc --version | cut -d' ' -f2)"
	@echo "  Cargo: $(shell cargo --version | cut -d' ' -f2)"

# –ü–æ–º–æ—â—å
help:
	@echo "ü¶Ä Rust Package Manager - –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo ""
	@echo "–°–±–æ—Ä–∫–∞:"
	@echo "  build         - –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ debug —Ä–µ–∂–∏–º–µ"
	@echo "  release       - –°–±–æ—Ä–∫–∞ –≤ release —Ä–µ–∂–∏–º–µ"
	@echo ""
	@echo "–ó–∞–ø—É—Å–∫:"
	@echo "  run           - –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã"
	@echo "  demo          - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π (—á–µ—Ä–µ–∑ demo.sh)"
	@echo "  quick-demo    - –ë—ã—Å—Ç—Ä–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π"
	@echo ""
	@echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:"
	@echo "  test          - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤"
	@echo "  test-verbose  - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º"
	@echo "  bench         - –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤"
	@echo ""
	@echo "–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:"
	@echo "  check         - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –±–µ–∑ —Å–±–æ—Ä–∫–∏"
	@echo "  fmt           - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞"
	@echo "  check-fmt     - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
	@echo "  lint          - –õ–∏–Ω—Ç–∏–Ω–≥ —Å clippy"
	@echo "  pre-commit    - –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º"
	@echo ""
	@echo "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
	@echo "  doc           - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"
	@echo ""
	@echo "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:"
	@echo "  deps          - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
	@echo "  clean         - –û—á–∏—Å—Ç–∫–∞ —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"
	@echo "  clean-all     - –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞"
	@echo "  install-system- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Å–∏—Å—Ç–µ–º—É"
	@echo ""
	@echo "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:"
	@echo "  info          - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ"
	@echo "  help          - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏
archive:
	@echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞..."
	tar -czf rust-package-manager.tar.gz --exclude=$(TARGET_DIR) --exclude=packages.json .
